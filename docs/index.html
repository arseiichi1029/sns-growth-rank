Set-Content -Encoding UTF8 docs\index.html @'
<!doctype html>
<html lang="ja">
<head>

  <!-- ★ AdSense SITE VERIFY（これが本命） -->
  <meta name="google-site-verification" content="ca-pub-5643751507480712" />

  <!-- 広告表示用（これは後でOK） -->
  <script async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-564375507480712"
    crossorigin="anonymous"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SNS Growth Rank</title>
  <link rel="stylesheet" href="./styles.css?v=2" />

</head>


<body data-theme="wiki">
  <div class="wrap">
    <div class="header">
      <div class="logo">
        <div class="logoMark" aria-hidden="true"></div>
        <div>
          <h1>SNS Growth Rank</h1>
          <p class="subtitle">請求ゼロ（GitHub Pages + GitHub Actions）</p>
        </div>
      </div>

      <div class="tabs">
        <button class="btn active" id="tabWiki" type="button">Wikipedia 急上昇</button>
        <button class="btn" id="tabTrends" type="button">Google Trends</button>
        <button class="btn" id="btn-reddit" type="button">Reddit</button>
        <button class="btn" id="btn-hn" type="button">Hacker News</button>
      </div>
    </div>

    <div class="ad" id="ad-top">AD PLACEHOLDER (top)</div>

    <div class="metaRow">
      <div><span class="badge" id="metaLeft">Wikipedia / ja</span></div>
      <div><span class="badge" id="metaRight">updated: -</span></div>
    </div>

    <div class="panel">
      <div class="notice" id="notice">loading...</div>
      <div class="list" id="list"></div>
    </div>

    <div class="ad" id="ad-bottom">AD PLACEHOLDER (bottom)</div>

    <div class="footer">
      <div>data: <span id="dataPath">-</span></div>
    </div>
  </div>

<script>
const $ = (id) => document.getElementById(id);

const PATHS = {
  wiki:   './data/wiki.json',
  trends: './data/trends_google.json',
  reddit: './data/trends_reddit.json',
  hn:     './data/trends_hn.json',
};

function setActive(mode){
  document.body.setAttribute('data-theme', mode);

  $('tabWiki').classList.toggle('active', mode === 'wiki');
  $('tabTrends').classList.toggle('active', mode === 'trends');
  $('btn-reddit').classList.toggle('active', mode === 'reddit');
  $('btn-hn').classList.toggle('active', mode === 'hn');

  const label =
    mode === 'wiki'   ? 'Wikipedia / ja' :
    mode === 'trends' ? 'Google Trends / ja' :
    mode === 'reddit' ? 'Reddit / hot' :
                        'Hacker News / top';

  $('metaLeft').textContent = label;
  $('dataPath').textContent = PATHS[mode] || '-';
}

function fmtNum(n){
  const x = Number(n || 0);
  return new Intl.NumberFormat('en-US').format(x);
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, (c)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
}

function clearList(){
  $('list').innerHTML = '';
}

function showNotice(kind, text){
  const n = $('notice');
  n.className = 'notice ' + (kind || '');
  n.textContent = text;
}

function renderItems(mode, items){
  clearList();
  const frag = document.createDocumentFragment();

  (items || []).slice(0, 50).forEach((it, i) => {
    const rank  = it.rank ?? (i+1);
    const title = it.title ?? it.query ?? it.name ?? '(no title)';
    const url   = it.url ?? it.link ?? it.permalink ?? '#';
    const val   =
      mode === 'wiki'   ? (it.views ?? 0) :
      mode === 'trends' ? (it.value ?? it.score ?? 0) :
      mode === 'reddit' ? (it.score ?? it.views ?? 0) :
                          (it.score ?? it.views ?? 0);

    const row = document.createElement('div');
    row.className = 'item';
    row.innerHTML = `
      <div class="rank">#${rank}</div>
      <div>
        <div class="title">${escapeHtml(title)}</div>
        <div class="url">${escapeHtml(url)}</div>
      </div>
      <div class="value">${fmtNum(val)}</div>
    `;

    row.addEventListener('click', () => {
      if (url && url !== '#') window.open(url, '_blank', 'noopener');
    });

    frag.appendChild(row);
  });

  $('list').appendChild(frag);
}

async function load(mode){
  setActive(mode);
  showNotice('', 'loading...');
  clearList();

  const url = (PATHS[mode] || PATHS.wiki) + '?v=' + Date.now();

  try{
    const res = await fetch(url, { cache: 'no-store' });
    if(!res.ok) throw new Error(res.status + ' ' + url);

    const json = await res.json();

    $('metaRight').textContent = 'updated: ' + (json.updatedAt || json.updated || '-');

    if (json.ok === false){
      showNotice('err', 'error: ' + (json.error || 'unknown'));
      return;
    }

    const items = json.items || [];
    showNotice('ok', 'loaded: ' + items.length);

    // Reddit/HNは views が無いので score を使って表示する
    renderItems(mode, items);

  }catch(e){
    showNotice('err', 'error: ' + (e && e.message ? e.message : String(e)));
  }
}

$('tabWiki').addEventListener('click', ()=>load('wiki'));
$('tabTrends').addEventListener('click', ()=>load('trends'));
$('btn-reddit').addEventListener('click', ()=>load('reddit'));
$('btn-hn').addEventListener('click', ()=>load('hn'));

load('wiki');
</script>

</body>
</html>
'@
