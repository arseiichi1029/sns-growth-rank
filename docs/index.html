<!doctype html>
<html lang="ja">
<head>
  
<!-- SEO:BEGIN -->
<title>SNS Growth Rank | Wikipedia/Trends/Reddit/HN 横断急上昇まとめ</title>
<meta name="description" content="Wikipedia急上昇・Google Trends・Reddit・Hacker News を横断して、いま伸びてる話題を1ページで把握。">
<link rel="canonical" href="https://mikann20041029.github.io/sns-growth-rank/">
<meta name="robots" content="index,follow,max-image-preview:large">
<meta property="og:type" content="website">
<meta property="og:title" content="SNS Growth Rank | Wikipedia/Trends/Reddit/HN 横断急上昇まとめ">
<meta property="og:description" content="Wikipedia急上昇・Google Trends・Reddit・Hacker News を横断して、いま伸びてる話題を1ページで把握。">
<meta property="og:url" content="https://mikann20041029.github.io/sns-growth-rank/">
<meta property="og:site_name" content="SNS Growth Rank">
<meta name="twitter:card" content="summary">
<!-- SEO:END -->
<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SNS Growth Rank</title>
  <link rel="stylesheet" href="./styles.css?v=2" />
  <meta name="description" content="Wikipedia急上昇 / Google Trends を自動更新で並べる" />
</head>
<body data-theme="wiki">
  <div class="wrap">
    <div class="header">
      <div class="logo">
        <div class="logoMark" aria-hidden="true"></div>
        <div>
          <h1>SNS Growth Rank</h1>
          <p class="subtitle">請求ゼロ（GitHub Pages + GitHub Actions）</p>
        </div>
      </div>

      <div class="tabs">
        <button class="btn active" id="tabWiki" type="button">Wikipedia 急上昇</button>
        <button class="btn" id="tabTrends" type="button">Google Trends</button>
      </div>
    </div>

    <!-- ad slot (top) -->
    <div class="ad" id="ad-top">AD PLACEHOLDER (top)</div>

    <div class="metaRow">
      <div><span class="badge" id="metaLeft">ja</span></div>
      <div><span class="badge" id="metaRight">updated: -</span></div>
    </div>

    <div class="panel">
      <div class="notice" id="notice">loading...</div>
      <div class="list" id="list"></div>
    </div>

    <!-- ad slot (bottom) -->
    <div class="ad" id="ad-bottom">AD PLACEHOLDER (bottom)</div>

    <div class="footer">
      <div>data: <span id="dataPath">-</span></div>
    </div>
  </div>

<script>
const $ = (id) => document.getElementById(id);

const PATHS = {
  wiki: './data/wiki.json',
  trends: './data/trends_google.json',
};

function setActive(mode){
  document.body.setAttribute('data-theme', mode);
  $('tabWiki').classList.toggle('active', mode === 'wiki');
  $('tabTrends').classList.toggle('active', mode === 'trends');
  $('metaLeft').textContent = mode === 'wiki' ? 'Wikipedia / ja' : 'Google Trends / ja';
  $('dataPath').textContent = (mode === 'wiki') ? PATHS.wiki : PATHS.trends;
}

function fmtViews(n){
  if (n === 0) return '0 views';
  if (!n) return '-';
  return new Intl.NumberFormat('en-US').format(n) + ' views';
}

function clearList(){
  $('list').innerHTML = '';
}

function renderItems(mode, items){
  clearList();
  const frag = document.createDocumentFragment();
  items.slice(0, 50).forEach((it, i) => {
    const rank = it.rank ?? (i+1);
    const title = it.title ?? it.query ?? it.name ?? '(no title)';
    const url = it.url ?? it.link ?? '';
    const views = it.views ?? it.value ?? 0;

    const row = document.createElement('div');
    row.className = 'item';
    row.innerHTML = `
      <div class="rank">#${rank}</div>
      <div>
        <div class="title">${escapeHtml(title)}</div>
        <div class="url">${escapeHtml(url)}</div>
      </div>
      <div class="value">${mode === 'wiki' ? fmtViews(views) : '0 views'}</div>
    `;
    row.addEventListener('click', () => { if (url) window.open(url, '_blank', 'noopener'); });
    frag.appendChild(row);
  });
  $('list').appendChild(frag);
}

function showNotice(kind, text){
  const n = $('notice');
  n.className = 'notice ' + (kind || '');
  n.textContent = text;
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, (c)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
}

async function load(mode){
  setActive(mode);
  showNotice('', 'loading...');
  clearList();

  const url = (mode === 'wiki' ? PATHS.wiki : PATHS.trends) + '?v=' + Date.now();
  try{
    const res = await fetch(url, { cache: 'no-store' });
    const json = await res.json();

    $('metaRight').textContent = 'updated: ' + (json.updatedAt || '-');

    if (!json.ok){
      showNotice('err', 'error: ' + (json.error || 'unknown'));
      return;
    }

    const items = json.items || [];
    showNotice('ok', 'loaded: ' + items.length);
    renderItems(mode, items);
  }catch(e){
    showNotice('err', 'error: ' + (e && e.message ? e.message : String(e)));
  }
}

$('tabWiki').addEventListener('click', ()=>load('wiki'));
$('tabTrends').addEventListener('click', ()=>load('trends'));

load('wiki');
</script>
<!-- ===== DESKTOP SIDE ADS (PC only) ===== -->
<div id="ad-left" class="ad-side ad-left">AD PLACEHOLDER (left)</div>
<div id="ad-right" class="ad-side ad-right">AD PLACEHOLDER (right)</div>
<!-- ====================================== -->
<!-- UNIFIED:BEGIN -->
<div class="unified-wrap">
  <div class="unified-head">
    <div class="unified-title">今日の急上昇まとめ（横断）</div>
    <div class="unified-sub">Wikipedia / Google Trends / Reddit / Hacker News をまとめて表示</div>
  </div>

  <div class="unified-panel">
    <div class="unified-status" id="unifiedStatus">loading...</div>
    <div class="unified-scroll">
      <table class="unified-table" id="unifiedTable">
        <thead>
          <tr>
            <th>#</th>
            <th>title</th>
            <th>source</th>
            <th class="unified-right">score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
(function(){
  const  = document.getElementById('unifiedStatus');
  const   = document.querySelector('#unifiedTable tbody');

  const SOURCE = {
    wiki:  { key:'wiki',  label:'Wikipedia',    cls:'tag-wiki'  },
    gtr:   { key:'gtr',   label:'GoogleTrends', cls:'tag-gtr'   },
    reddit:{ key:'reddit',label:'Reddit',       cls:'tag-reddit'},
    hn:    { key:'hn',    label:'HackerNews',   cls:'tag-hn'    },
  };

  function pick(o, keys){
    for (const k of keys){
      if (o && o[k] != null && String(o[k]).trim() !== '') return o[k];
    }
    return '';
  }

  // どんなJSONでも「それっぽい項目」を拾って統一する（壊れにくい）
  function normalizeItems(srcKey, data){
    const raw = (data && (data.items || data.data || data.results || data.children || data.hits)) || data;
    const arr = Array.isArray(raw) ? raw : (raw && Array.isArray(raw.items) ? raw.items : []);
    const out = [];

    for (let i=0; i<arr.length; i++){
      const it = arr[i] || {};
      const title = pick(it, ['title','name','headline','text','story_title']);
      const url   = pick(it, ['url','link','permalink','story_url']);

      // 数値っぽいのがあれば拾う（views/score/points/comments など）
      const metric =
        Number(pick(it, ['views','viewCount','score','points','upvotes','ups','num_comments','comments','commentCount'])) || 0;

      // スコアは「順位優先 + 数値があるなら少し加点」で雑に統一
      const rank = i + 1;
      const s = (1 / rank) * 1000 + Math.min(metric, 100000) * 0.01;

      if (!title) continue;

      out.push({
        title,
        url,
        source: srcKey,
        score: Math.round(s)
      });
    }
    return out;
  }

  async function fetchJson(path){
    const r = await fetch(path, { cache:'no-store' });
    if (!r.ok) throw new Error(r.status + ' ' + path);
    return await r.json();
  }

  async function main(){
    try{
      const files = [
        {src:'wiki',   path:'./data/wiki_ja.json'},
        {src:'gtr',    path:'./data/trends_google.json'},
        {src:'reddit', path:'./data/trends_reddit.json'},
        {src:'hn',     path:'./data/trends_hn.json'},
      ];

      const all = [];
      for (const f of files){
        try{
          const j = await fetchJson(f.path);
          if (j && j.ok === false && j.error) {
            // 失敗でも落とさず続行
            console.warn('source error', f.src, j.error);
          }
          all.push(...normalizeItems(f.src, j));
        }catch(e){
          console.warn('fetch error', f.src, e);
        }
      }

      // ソース被り（同じtitle）を軽く排除
      const seen = new Set();
      const uniq = [];
      for (const x of all.sort((a,b)=>b.score-a.score)){
        const key = (x.title || '').toLowerCase().trim();
        if (!key) continue;
        if (seen.has(key)) continue;
        seen.add(key);
        uniq.push(x);
        if (uniq.length >= 50) break;
      }

      .innerHTML = '';
      uniq.forEach((x, idx) => {
        const s = SOURCE[x.source] || {label:x.source, cls:'tag-wiki'};
        const tr = document.createElement('tr');

        const safeUrl = (x.url && String(x.url).startsWith('http')) ? x.url : '';
        const titleHtml = safeUrl
          ? '<a href="' + safeUrl + '" target="_blank" rel="noopener noreferrer">' + escapeHtml(x.title) + '</a>'
          : escapeHtml(x.title);

        tr.innerHTML = 
          <td class="unified-rank">#</td>
          <td class="unified-titlecell"></td>
          <td><span class="src-tag "></span></td>
          <td class="unified-right"></td>
        ;
        .appendChild(tr);
      });

      .textContent = 'loaded: ' + uniq.length;
    }catch(e){
      console.error(e);
      .textContent = 'error';
    }
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'",'&#39;');
  }

  main();
})();
</script>
<!-- UNIFIED:END -->
</body>
</html>





